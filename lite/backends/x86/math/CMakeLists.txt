FILE(GLOB x86_math_src ${CMAKE_CURRENT_SOURCE_DIR}/*.cc)
FILE(GLOB x86_avx_math_src ${CMAKE_CURRENT_SOURCE_DIR}/avx/*.cc)

if (WITH_AVX AND AVX_FOUND)
  set(x86_math_src ${x86_math_src} ${x86_avx_math_src})
  if (WIN32)
    set_source_files_properties (${x86_math_src} PROPERTIES COMPILE_FLAGS "/arch:AVX2 /DAVX2 /fp:strict")
  else ()
    set_source_files_properties (${x86_math_src} PROPERTIES COMPILE_FLAGS "-mfma -mf16c -mavx2")
  endif ()
endif()
set(x86_math_deps core framework_proto)
if(WITH_MKL)
  if(WITH_STATIC_MKL)
    set(x86_math_deps ${x86_math_deps} ${MKLML_LIBRARIES})
  else()
    set(x86_math_deps ${x86_math_deps} dynload_mklml)
  endif()
endif()

lite_cc_library(x86_math SRCS ${x86_math_src} DEPS ${x86_math_deps})
add_dependencies(x86_math eigen3)
