# 最佳做法

移动设备和嵌入式设备的计算资源有限，因此提高应用的资源效率非常重要。我们整理了一份最佳做法和策略的清单，可用于改善 Paddle Lite 模型的性能。

## 为任务选择最佳模型

您需要根据任务在模型复杂性和大小之间进行权衡。如果您的任务需要高准确率，那么您可能需要一个大而复杂的模型。对于准确率要求较低的任务，则最好使用较小的模型，因为它们不仅占用的磁盘空间和内存更少，而且通常速度更快且更节能。

## 对模型进行性能分析

在选择了合适的候选模型后，最好对模型进行性能分析和基准测试。Paddle Lite 基准测试工具[Profiler 工具](./profiler.md)有内置的性能分析器，可展示每个算子的性能分析数据。这能帮助理解性能瓶颈，以及哪些算子占据了大部分计算时间。

### 对计算图中的算子进行性能分析和优化

如果某个特定的算子频繁出现在模型中，并且基于性能分析，您发现该算子消耗的时间最多，则可以考虑优化该算子。这种情况应该会很少见，因为 Paddle Lite 为大多数算子提供了优化版本。但是，如果您知道执行算子的约束条件，则可以编写自定义算子的更快版本，具体添加算子方法请见[新增OP文档](../develop_guides/add_operation.md)。

### 优化模型

模型优化旨在创建更小的模型，这些模型通常更快、更节能，从而可以将其部署在移动设备上。Paddle Lite 支持量化等多种优化技术。

有关详细信息，请查看我们的模型[量化文档](../user_guides/quant_post_static.md)。

### 调整线程数

Paddle Lite 支持用于许多算子的多线程内核。您可以增加线程数并加快算子的执行速度。但是，增加线程数会使模型使用更多资源和能源。

对某些应用来说，延迟或许比能效更重要。您可以通过设置解释器线程数来增加线程数。然而，多线程执行的代价是增加了性能可变性，具体取决于并发执行的其他内容。对于移动应用来说，情况尤其如此。例如，单独的测试可能会显示速度比单线程快 2 倍，但是，如果另一个应用同时执行，可能会导致其性能比单线程更差。

## 用平台特定工具对您的应用进行性能分析

平台特定工具（如 [Android Profiler](https://developer.android.google.cn/studio/profile/android-profiler) 和 [Instruments](https://help.apple.com/instruments/mac/current/）提供了丰富的可被用于调试应用的性能分析信息。有时错误可能不在模型中，而在与模型交互的部分应用代码中。请务必熟悉平台特定的性能分析工具和适用于该平台的最佳做法。

## 评估您的模型是否能从使用设备上可用的硬件加速器中受益

Paddle Lite 添加了使用速度更快的硬件（如 GPU、NPU 和 APU 等）来加速模型的新方式，其他新硬件执行方法可参考[各硬件使用文档](../demo_guides)进行支持。

请注意，有些加速器更适合不同类型的模型。有些新硬件只支持浮点模型或以特定方式优化的模型。请务必对每个硬件类型进行基准测试，以查看它是否适合您的应用。例如，如果您有一个非常小的模型，将该模型放在 GPU 可能不值得。相反，对于具有高运算强度的大型模型来说， GPU 就是很好的选择。
